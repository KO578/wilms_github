
library(leaflet)
install.packages("dataRetrieval")
library(dataRetrieval)
label11<-sprintf("%s", questions$question)%>% lapply(htmltools::HTML)

#lake centers
cnt = rgeos::gCentroid(impaired_lakes, byid = TRUE)
crd = data.frame(coordinates(impaired_lakes))

GetURL <- function(service, host = "basemap.nationalmap.gov") {
  sprintf("https://%s/arcgis/services/%s/MapServer/WmsServer", host, service) }    
                  
map2=leaflet()  %>% 
  #addTiles(group = "Street View") %>% 
  #addProviderTiles(providers$Esri.WorldImagery, group = "Satellite") %>%
  addWMSTiles(GetURL("USGSTopo"),group = "Topo", layers = "0") %>%
  #addProviderTiles(providers$Esri.WorldShadedRelief, group = "Relief") %>%
  setView(lng = -87.870196, lat=44.104887,zoom=9) %>% 
addPolygons(data=impaired_lakes,
            color="red",
            fillOpacity=.3,
            group="2020 Impaired Lakes (TP)",
            popup=label13,
            popupOptions=popupOptions(autoClose = FALSE, closeOnClick = FALSE),
            dashArray = "",
            highlight = highlightOptions(weight = 5,
                                         color = "#666",
                                         fillOpacity = 0.7,
                                         bringToFront = TRUE),
            labelOptions = labelOptions(style = list("font-weight" = "normal", padding = "3px 8px"),
                                        textsize = "15px",
                                        direction = "auto"))%>% 
addLabelOnlyMarkers(data=crd,
                    lng=~X1, lat=~X2,label=impaired_lakes@data$Lake,
                    labelOptions=labelOptions(noHide=TRUE, textOnly=TRUE, style=list('color'='#711010')))%>%
  addCircleMarkers(data=questions,
                   radius = 10,
                   color="blue",
                   weight=2,
                   opacity=0.8,
                   group="questions",
                   popup=label11,
                   popupOptions=popupOptions(autoClose = FALSE, closeOnClick = FALSE),
                   popupOptions = labelOptions(style = list("font-weight" = "normal", padding = "3px 8px"),
                                               textsize = "30px",
                                               direction = "auto"))%>%
  addLabelOnlyMarkers(data=crd3,
                      lng=~coords.x1, lat=~coords.x2,label=questions@data$Name, group="questions",
                      labelOptions=labelOptions(noHide=TRUE,textsize=5, style=list('color'='black','font-size'='12px')))

map2


